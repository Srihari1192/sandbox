name: Managed Connectors Cleanup
on:
  push:
    branches:
      - MGDOBR-1008test
jobs:
  run-managed-connectors-delete-script:
    timeout-minutes: 30
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          ref: "MGDOBR-1008test"
      - name: Free disk space
        uses: ./.github/actions/free-disk-space
      - name: Download and Install ocm
        shell: bash
        run: |
          echo Path variable is :
          echo $PATH
          mkdir -p $HOME/.local/bin
          curl -Lo $HOME/.local/bin/ocm https://github.com/openshift-online/ocm-cli/releases/download/v0.1.64/ocm-linux-amd64
          chmod +x $HOME/.local/bin/ocm
          export PATH=$HOME/.local/bin/ocm:$PATH
          ocm login --token $MANAGED_CONNECTORS_AUTH_OFFLINE_TOKEN
      - name: Add mask
        run: |
          echo "::add-mask::${{ secrets.MANAGED_CONNECTORS_CONTROL_PLANE_URL }}"
      - name: Run Managed connector delete scripts
        env:
          MANAGED_CONNECTORS_CONTROL_PLANE_URL: ${{ secrets.MANAGED_CONNECTORS_CONTROL_PLANE_URL }}
          ENV_TEST: Managed connector delete
        run: |
          chmod +x .github/scripts/delete-managed-connectors.sh
          ./.github/scripts/delete-managed-connectors.sh
